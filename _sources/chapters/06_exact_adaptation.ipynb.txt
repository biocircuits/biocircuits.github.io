{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "a99eecca-b434-4c21-8691-5e9e57900f69",
   "metadata": {},
   "source": [
    "# 6. Exact adaptation in the chemotaxis pathway\n",
    "\n",
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b9bdbc0c-727c-43f1-8af0-6d4dd49efff8",
   "metadata": {},
   "source": [
    "\n",
    "\n",
    "\n",
    "**Concepts**\n",
    "\n",
    "- Exact adaptation allows a system to sense changes in signal across a wide dynamic range of ambient signal levels.\n",
    "\n",
    "\n",
    "**Design principles**\n",
    "\n",
    "- Activity dependent negative feedback enables exact adaptation.\n",
    "\n",
    "\n",
    "**Techniques**\n",
    "\n",
    "- Michaelis-Menten kinetics allow modeling of enzyme dynamics.\n",
    "\n",
    "\n",
    "<!--\n",
    "**Systems**\n",
    "\n",
    "- Bacterial chemotaxis\n",
    "-->\n",
    "\n",
    "<hr>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a7ece621-a721-49fe-9e1d-0f9d574991e1",
   "metadata": {},
   "source": [
    "<hr>\n",
    "\n",
    "## Exact adaptation enables gradient sensing\n",
    "\n",
    "The previous chapter provided a first glimpse of robustness. We saw how the simple IFFL circuit architecture could, under the right conditions, make a protein's concentration independent of the number of copies of its own gene. Today, we will extend the concept of robustness in two ways: First, we will shift from static steady state protein expression systems to dynamic signal transduction systems that can sense rates of change in their input. Second, we will shift from the level of gene expression circuits that has captured our attention so far to the level of circuits of interacting proteins. To do this, we will focus on one of the best studied signaling systems in biology: bacterial chemotaxis and its ability to exactly adapt biochemical pathway activity to the same constant level across a wide range of input concentrations.\n",
    "\n",
    "Before we get started, consider a familiar example of adaptation in our own visual system. Outdoors, your eyes are sensitive to relative differences in light intensity, allowing you to clearly see the world around you. Step inside, and ambient light intensities decrease by orders of magnitude. Initially, everything looks dim. But over the next ~15 or so minutes, your eyes increase their \"gain\" and soon enough objects look bright again. Your visual system has adapted to lower light by increasing amplification. This allows it to remain sensitive to variations in light intensity around the ambient level. Even when blind to light, bacteria can achieve something similar.\n",
    "\n",
    "Bacterial cells are sensitive, hungry, and frightened. They navigate through space towards regions of higher concentrations of some molecules, termed attractants, and away from others, termed repellents. (Here, we will focus on attractants, but similar behaviors are observed for repellents.) Navigation requires that bacteria sense local gradients of attractant and move up them. \n",
    "\n",
    "Due to their small size, they must infer these spatial gradients by swimming for a little while, and then checking whether attractant concentrations are increasing or decreasing. In other words, they use swimming to convert spatial gradients into temporal gradients. When conditions are improving (attractant is increasing) they tend to keep swimming in the same direction. Otherwise, they under go a directional randomization process called \"tumbling\" and set off in a new direction. Remarkably, they are able to sense spatial gradients in attractants over five orders of magnitude of ambient concentrations. For a beautiful description of how bacteria swim up gradients, you should read the classic paper by Berg and Purcell ([Berg and Purcell, 1977](https://doi.org/10.1016/S0006-3495(77)85544-6)).\n",
    "\n",
    "For this to work, bacteria must constantly adapt their basal signal perception to the ambient environment. If they did not, their sensory system would either be flooded, at high attractant concentration, or be completely shut off, at low attractant concentration. In either extreme, they would be \"blind\" to local variations. More precisely, the signaling system must  exhibit **exact adaptation**, meaning its value should always returns to the same initial steady state level after a change in its input value. \n",
    "\n",
    "\n",
    "<div style=\"width: 400px; margin: auto;\">\n",
    "    \n",
    "![CheA system](figs/ExactAdaptationSchematic.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "\n",
    "In this chapter, we will explore various models of the *E. coli* Che (pronounced \"key\") system, which governs its chemotaxis, to understand how this exact adaptation is accomplished. This treatment is largely based on Chapter 9 of Uri Alon's *Systems Biology*, 2nd Ed., which should be consulted for a deeper treatment of each molecular model."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7abd8a87-65ff-4bd7-830d-0eefc7ad8d4c",
   "metadata": {},
   "source": [
    "## The molecular sources of robustness in the *E. coli* chemotaxis system\n",
    "\n",
    "To understand how _E. coli_ perform chemotaxis, we must first understand how _E. coli_ swim. Their flagellar motors spin in an anticlockwise direction when they are being propelled forward in a so-called \"run.\" Occasionally, a few of the motors switch to a clockwise rotation, which causes the bacterium to stall and spin in a so-called \"tumble.\" When the motors switch to spinning anticlockwise, the bacterium runs again in a new, random direction.\n",
    "\n",
    "If a bacterium is swimming up a gradient of attractant, its switching frequency decreases and it continues up the gradient. If however, there is no _gradient_, but rather a more uniform concentration of attractant, the switching frequency returns back to the level it was before detecting the gradient. This leads to a statement about robustness: **The steady state tumbling frequency of the Che system is robust to variations in _total_ attractant concentration** over an operating regime that spans over five orders of magnitude of total attractant concentration!\n",
    "\n",
    "The switching frequency is controlled by the Che system, shown in the image below.\n",
    "\n",
    "<div style=\"width: 400px; margin: auto;\">\n",
    "    \n",
    "![CheA system](figs/chea_system.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "The CheA receptor complex, which we shall call X, is autophosphorylated. CheA can transfer its phosphate to an effector protein called CheY. Phosphorylated CheY can interact with the flagellar motor to induce tumbling. Attractants inhibit autophosphorylation, reducing phosphorylation of CheY, and thereby suppressing tumbles.\n",
    "\n",
    "Within the model, making the steady state tumbling frequency  invariant to total attractant concentration requires that the level of phosphorylated CheA  return to the same steady state _regardless of the attractant concentration_. "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d2f7f7ec-074c-480a-a525-42642b2eb7dd",
   "metadata": {},
   "source": [
    "### The CheA circuit\n",
    "\n",
    "\n",
    "\n",
    "In our analysis of the Che circuit, we will zoom in on the CheA portion of the circuit in the orange box in the figure above. We will consider a simplified version of the circuit that omits some states and interactions but allows undderstanding of the key feature of exact adaptation.\n",
    "\n",
    "Activation of the CheA receptor complex involves multiple molecules and states. The CheA receptor complex has active and inactive states, with attractant binding favoring the inactive state. Furthermore, CheA can be methylated by a methyltransferase called CheR or demethylated by an opposing methylesterase, CheB. (See [Parkinson, et al., 2015](http://doi.org/10.1016/j.tim.2015.03.003) for a review of the molecules involved in the circuit.) A simplified schematic of these interactions is shown in the image below.\n",
    "\n",
    "We will consider the activity in the purple box phenomenologically, positing that\n",
    "\n",
    "\\begin{align}\n",
    "\\text{tumbling frequency} \\equiv f = g(a)\\,x_m^*,\n",
    "\\end{align}\n",
    "\n",
    "where $g(a)$ is some function of the attractant concentration, $a$, and $x_m^*$ is the concentration of the active methylated CheA receptor complex.\n",
    "\n",
    "\n",
    "<div style=\"width: 600px; margin: auto;\">\n",
    "    \n",
    "![fine-tuned Che system](figs/finetuned_che.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "The combination of being in the active and methylated state results in a much more active receptor, so we will be most interested in the concentration of $\\mathrm{X}_m^*$. "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ab8c68aa-e00d-49ba-8f36-aebc674952ee",
   "metadata": {},
   "source": [
    "### Approximate dynamics of the Che signaling system\n",
    "\n",
    "We will use Michaelis-Menten kinetics to describe the dynamics of the Che system. You can read about the principles behind this kinetics scheme and the resulting equations in [Technical Appendix 6a](../technical_appendices/06a_michaelis_menten.ipynb). \n",
    "\n",
    "Because of the more verbose names of the species (e.g., \"$\\mathrm{X}_m^*$\" instead of \"S\"), we will denote concentrations of respective species with lower case letters, e.g. $x_m^*$ instead of $c_\\mathrm{X_m^*}$.\n",
    "\n",
    "We will assume that the quasi-steady state approximation holds for all enzyme-catalyzed reactions. We assume further that CheR operates at saturation. This means that there is so much substrate (in this case methylated and unmethlyated CheA receptor complex) such that the rate of methylation by CheR is directly proportional to the CheR concentration.\n",
    "\n",
    "We can write ODEs for the concentration of each of the methylated species.\n",
    "\n",
    "\\begin{align}\n",
    "&\\frac{\\mathrm{d}x^*_m}{\\mathrm{d}t} = k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b^*\\,\\frac{x_m^*/K_\\mathrm{M}}{1 + x_m^*/K_\\mathrm{M}}, \\\\[1em]\n",
    "&\\frac{\\mathrm{d}x_m}{\\mathrm{d}t} = k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b^*\\,\\frac{x_m/\\kappa_\\mathrm{M}}{1 + x_m/\\kappa_\\mathrm{M}},\n",
    "\\end{align}\n",
    "\n",
    "where $K_\\mathrm{M}$ and $\\kappa_m$ are respectively Michaelis constants for demethylation of active and inactive CheA complex by CheB, and $b^*$ is the concentration of active CheB. For now, for ease of discussion, we will assume that nearly all of the CheB is active, such that $b^* \\approx b_0$, where $b_0$ is the total CheB concentration. We can add these two equations together to get an ODE for the rate of change of _total_ methylated CheA.\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}(x^*_m + x_m)}{\\mathrm{d}t} = \\frac{\\mathrm{d}x_m^\\mathrm{tot}}{\\mathrm{d}t} = 2k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b_0\\left(\\frac{x_m^*/K_\\mathrm{M}}{1 + x_m^*/K_\\mathrm{M}} + \\frac{x_m/\\kappa_m}{1 + x_m/\\kappa_m}\\right),\n",
    "\\end{align}\n",
    "\n",
    "At steady state, the derivative vanishes, and the resulting equation can be solved for $x_m^*$.\n",
    "\n",
    "\\begin{align}\n",
    "x_m^* = K_\\mathrm{M}\\,\\frac{2 k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b\\,\\frac{x_m/\\kappa_m}{1 + x_m/\\kappa_m}}{k_\\mathrm{cat}^\\mathrm{B} b - 2k_\\mathrm{cat}^\\mathrm{R} r + k_\\mathrm{cat}^\\mathrm{B} b_0\\,\\frac{x_m/\\kappa_m}{1 + x_m/\\kappa_m}}.\n",
    "\\end{align}\n",
    "\n",
    "Note that as $x_m$ grows, the numerator decreases, while the denominator increases. So, for increasing $x_m$, $x_m^*$ decreases. Because the amount of $x_m$ is dependent on the amount of attractant present (more attractant means the equilibrium shifts toward the inactive conformations, $x$ and $x_m$), the concentration of active CheA receptor complex is dependent on the attractant concentration in this model."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fc72613c-e6ca-4ffa-8e31-04f3803f7089",
   "metadata": {},
   "source": [
    "### Fine-tuned exact adaptation\n",
    "\n",
    "We recall that we model the tumbling frequency as\n",
    "\n",
    "\\begin{align}\n",
    "f = g(a)\\,x_m^*.\n",
    "\\end{align}\n",
    "\n",
    "Before the attractant is present, we have a tumbling frequency of $f_0 = g_0 x_{m,0}^*$, and after we have $f_1 = g_1 x_{m,1}^*$, where $g_0 = g(a_0)$ and $g_1 = g(a_1)$. Note that addition of attractant also shifts the balance between methylated and unmethylated CheA receptor complex, so $x_m$ is affected. We define \n",
    "\n",
    "\\begin{align}\n",
    "\\theta = 2k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b_0\\,\\frac{x_m/\\kappa_m}{1 + x_m/\\kappa_m}.\n",
    "\\end{align}\n",
    "\n",
    "Then, the concentration of active methylated CheA complex is\n",
    "\n",
    "\\begin{align}\n",
    "x_m^* = K_\\mathrm{M}\\,\\frac{\\theta}{k_\\mathrm{cat}^\\mathrm{B} b_0 - \\theta}.\n",
    "\\end{align}\n",
    "\n",
    "With this expression, we can write down the two tumbling frequencies.\n",
    "\n",
    "\\begin{align}\n",
    "f_0 = g_0 x_{m,0}^* = g_0 K_\\mathrm{M} \\,\\frac{\\theta_0}{k_\\mathrm{cat}^\\mathrm{B} b_0 - \\theta_0}, \\\\[1em]\n",
    "f_1 = g_1 x_{m,1}^* = g_1 K_\\mathrm{M} \\,\\frac{\\theta_1}{k_\\mathrm{cat}^\\mathrm{B} b_0 - \\theta_1}.\n",
    "\\end{align}\n",
    "\n",
    "For exact adaptation for this particular concentration of attractant, we must have $f_0 = f_1$, or\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{f_1}{f_0} = \\frac{\\theta_1(k_\\mathrm{cat}^\\mathrm{B} b_0 - \\theta_0)}{\\theta_0(k_\\mathrm{cat}^\\mathrm{B} b_0 - \\theta_1)} = 1.\n",
    "\\end{align}\n",
    "\n",
    "The problem is that this ratio must hold for _any_ $a_0$ and $a_1$ within an operating regime if exact adaptation is to be robust. This results in a delicate balancing act, since $\\theta$ changes with varying attractant concentration. This is an example of **fine-tuning**. Exact adaptation is only possible by precisely setting parameters for a given pair of attractant concentrations, and the exact adaptation is lost if those attractant concentrations change at all."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3be8ceff-c826-4662-8df4-b173cdca1b1c",
   "metadata": {},
   "source": [
    "### Robust exact adaptation\n",
    "\n",
    "Let us now assume a different architecture of the Che circuit. We will assume that CheB only demethylates _active_ receptors, rendering them inactive. The circuit diagram in this case is\n",
    "\n",
    "<div style=\"width: 600px; margin: auto;\">\n",
    "    \n",
    "![robust CheA](figs/chea_robust.png)\n",
    "\n",
    "</div>\n",
    "                                       \n",
    "Taking the same approach as before, we can again write down the dynamics for the total amount of methylated CheA complex. We will again assume that CheR is operating at saturation.\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}(x_m +x_m^*)}{\\mathrm{d}t} = k_\\mathrm{cat}^\\mathrm{R} r - k_\\mathrm{cat}^\\mathrm{B} b^*\\,\\frac{x_m^*/K_\\mathrm{M}}{1+x_m^*/K_\\mathrm{M}}.\n",
    "\\end{align}\n",
    "\n",
    "At steady state, the time derivative vanishes, and we have\n",
    "\n",
    "\\begin{align}\n",
    "x_m^* = K_\\mathrm{M}\\,\\frac{k_\\mathrm{cat}^\\mathrm{R} r}{k_\\mathrm{cat}^\\mathrm{B} b_0 - k_\\mathrm{cat}^\\mathrm{R} r},\n",
    "\\end{align}\n",
    "\n",
    "where we have again assumed the $b^* \\approx b_0$.\n",
    "\n",
    "This is independent of $x_m$, and is dependent only on the parameters and concentrations pertaining to the CheB and CheR enzymes. If we have the simplest model where $g(a) = \\text{constant}$, then exact adaptation is achieved over all attractant concentrations. Furthermore, exact adaptation is robust to variations in parameter values (like CheR concentration, $k_\\mathrm{cat}^\\mathrm{B}$, etc.), provided the Michaelis-Menten kinetics are valid and CheR operates at saturation.\n",
    "\n",
    "<!--\n",
    "Let us relax the $b^* \\approx b_0$ approximation. Assuming Michaelis-Menten kinetics for phosphorylation,\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}b^*}{\\mathrm{d}t} = k_\\mathrm{cat}^\\mathrm{X}\\,x_m^*\\,\\frac{b/K_\\mathrm{M}^\\mathrm{X}}{1 + b/K_\\mathrm{M}^\\mathrm{X}} - k_\\mathrm{d}b^* =  k_\\mathrm{cat}^\\mathrm{X}\\,x_m^*\\,\\frac{(b_0-b^*)/K_\\mathrm{M}^\\mathrm{X}}{1 + (b_0-b^*)/K_\\mathrm{M}^\\mathrm{X}} - k_\\mathrm{d}b^*,\n",
    "\\end{align}\n",
    "\n",
    "where $b$ is the concentration of dephosphorylated CheB and $k_\\mathrm{d}$ is the rate of dephosphorylation of CheB. If most of the CheB is active or there is not much CheB around, such that $b/K_\\mathrm{M}^\\mathrm{X} \\ll 1$, then this is\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}b^*}{\\mathrm{d}t} = \\frac{k_\\mathrm{cat}^\\mathrm{X}}{K_\\mathrm{M}^\\mathrm{X}}\\,x_m^*\\,b - k_\\mathrm{d}b^* = k_x\\,x_m^*\\,b - k_\\mathrm{d}b^*,\n",
    "\\end{align}\n",
    "\n",
    "where we have defined the constant $k_x$ as $k_x = k_\\mathrm{cat}^\\mathrm{X} / K_\\mathrm{M}^\\mathrm{X}$.\n",
    "If the total concentration of CheB is $b_0 = b + b^*$, then\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}b^*}{\\mathrm{d}t} = k_x\\,x_m^*\\,(b_0-b^*) - k_\\mathrm{d}b^*.\n",
    "\\end{align}\n",
    "\n",
    "If the dynamics of CheB phosphorylation are fast compared to the other CheA dynamics,the time derivative vanishes (as it does at steady state, which we are primarily interested in anyway), and we can solve for the concentration of active CheB as\n",
    "\n",
    "\\begin{align}\n",
    "b^* = b_0\\,\\frac{x_m^*/k_x}{1+x_m^*/k_x}.\n",
    "\\end{align}\n",
    "-->\n",
    "\n",
    "While exact adaptation is robust to variation in parameter values, the steady state tumbling frequency is _not_. As you can see in the expression above, it explicitly depends on several parameters.\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "be01d9f5-5b9f-472b-ac6a-cfebf6265f48",
   "metadata": {},
   "source": [
    "## A more complex model for chemotaxis\n",
    "\n",
    "In the model for chemotaxis that we have considered, there are only two methylation states of the receptor, either unmethylated or methylated. In a more general model, we could consider multiple methylation states of the receptor. That is, it could be unmethylated, once methylated, twice methylated, ..., m-times methylated. Such a system was analyzed computationally by [Barkai and Leibler (1997)](https://doi.org/10.1038/43199).\n",
    "\n",
    "Because the model for generic number of methylation states is not tractable analytically as the one we have considered, Barkai and Leibler instead did a computational exploration of the parameter space. They began with a set of $n$ parameters $k_1^0$, $k_2^0$, ..., $k_n^0$. They randomly varied these parameters to get a new set of parameters $k_1$, $k_2$, ..., $k_n$. They defined the total parameter variation $K$ according to\n",
    "\n",
    "\\begin{align}\n",
    "\\ln K = \\sum_{i=1}^n \\left|\\ln\\,\\frac{k_i}{k_i^0}\\right|.\n",
    "\\end{align}\n",
    "\n",
    "For this new set of parameters, they solved the system of ODEs numerically from a steady state in response to an abrupt step up in ligand. If the probability of being in an active state for the original set of parameters is $A_0$ and for the perturbed parameters is A, then the precision of adaptation, $P$, is defined as $P = A_0 / A$. \n",
    "\n",
    "The results from thousands of such perturbations and calculations of the precision of adaptation is shown below. This image was taken from the Barkai and Liebler paper (which unfortunately has the Nature Publishing Group watermark on it). \n",
    "\n",
    "<div style=\"width: 450px; margin: auto;\">\n",
    "    \n",
    "![barkai and leibler p](figs/barkai_leiber_p.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "\n",
    "In the top plot, the black diamond in the upper left corner represents the original set of parameters. In the inset, the response for the original set of parameters is shown (solid line) along with an example response, corresponding to the white box.\n",
    "\n",
    "To make clear the overlapping points in the top plot, the bottom plot shows the fraction of parameter sets for which the precision of adaptation $P < 0.95$ for various values of the total parameter variation $K$. These plots demonstrate that even over large degrees of parameter variation, up to a total of four or five orders of magnitude, the system can still achieve rather exact adaptation.\n",
    "\n",
    "Conversely, Barkai and Leibler found that the time to steady state is *not* robust to parameter variations. "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4f64a2f9-82eb-49c7-95f2-8be0a2cc8692",
   "metadata": {},
   "source": [
    "## Exact adaptation in the Che system is robust to CheR levels, as shown experimentally\n",
    "\n",
    "How do the tumbling frequency, the adaptation time, and the precision of adaptation depend on CheR expression in real cells? To find out, Alon et al engineered bacteria in which CheR expression could be controlled by an inducer called IPTG ([Alon, et al., 1999](https://doi.org/10.1038/16483)). They then used time-lapse microscopy to observe the tumbling behavior of cells before and after adding a saturating amount of chemoattractant. They quantified the frequency of tumbling events (tumbling frequency), the time required for that frequency to return to its initial value after adding attractant (adaptation time), and the precision of adaptation. \n",
    "\n",
    "<div style=\"width: 450px; margin: auto;\">\n",
    "    \n",
    "![robustness tumbling](figs/alon_leibler_robustness.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "Consistent with the model predictions, the precision of adaptation is robust to varying levels of CheR over about two orders of magnitude. They also found that steady-state tumbling frequency and adaptation time were *not* robust to varying levels of CheR, as the model predicts.\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d1325255-65aa-4895-a8f6-3feab8195b8a",
   "metadata": {},
   "source": [
    "<!-- JB: I think we should cut integral feedback entirely or make it its own chapter.\n",
    "\n",
    "## Integral feedback\n",
    "\n",
    "The chemotaxis system we have studied in this lesson achieves exact adaptation robustly via a mechanism called **integral feedback control**, as first noticed by [Yi and coworkers](https://doi.org/10.1073/pnas.97.9.4649). The key features of integral feedback control are:\n",
    "\n",
    "- The steady state is independent of external perturbation.\n",
    "- The system tends toward steady state as time tends toward infinity; i.e., it is asymptotically stable.\n",
    "- The time integral of error is fed back into the system.\n",
    "\n",
    "A block diagram for integral control is shown below. The desired output is $y_0$ and the actual output is $y$, so the error is $e = y_0 - y$. This error is integrated over time, multiplied by a gain $k$, and then added to the a perturbation $u$. In the context of the chemotaxis system, the perturbation is the change in attractant concentration.\n",
    "\n",
    "<div style=\"width: 550px; margin: auto;\">\n",
    "    \n",
    "![integral feedback](figs/integral_feedback.png)\n",
    "\n",
    "</div>\n",
    "\n",
    "Image from Del Vecchio and Murray, *Biomolecular Feedback Systems*, Princeton University Press, 2015.\n",
    "\n",
    "<br />\n",
    "\n",
    "If we write ODEs for this diagram, we have that\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}z}{\\mathrm{d}t} = e(t) = y_0 - y,\n",
    "\\end{align}\n",
    "\n",
    "with $y = kz + u$, giving\n",
    "\n",
    "\\begin{align}\n",
    "\\frac{\\mathrm{d}z}{\\mathrm{d}t} = e(t) = y_0 - kz - u.\n",
    "\\end{align}\n",
    "\n",
    "The steady state is then $y = y_0$, which is asymptotically stable if the gain $k$ is positive and the perturbation is constant (such as a change in attractant concentration). In the present case, the term $kz$ represents the linearized balance between methylated and unmethylated CheA receptor complex. Importantly, the integral feedback ensures that the steady state is independent of the perturbation $u$.\n",
    "\n",
    "You can read more about integral feedback in [section 3.2 of Del Vecchio and Murray's book](http://www.cds.caltech.edu/~murray/books/AM08/pdf/bfs-dynamics_14Sep14.pdf) and in [this very nice primer on control theory in synthetic biology](https://doi.org/10.1109/MCS.2018.2810459) by Swaminathan, Hsiao, and Murray.\n",
    "\n",
    "-->"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1bb7b2f5-0657-4e34-905b-92e73fd86439",
   "metadata": {},
   "source": [
    "<hr>\n",
    "\n",
    "## References\n",
    "\n",
    "- Alon, et al., Robustness in bacterial chemotaxis, _Nature_, 397, 168–171, 1999. ([link](https://doi.org/10.1038/16483))\n",
    "- Berg, H. C. and Purcell, E. M., Physics of chemoreception, _Biophys. J._, 20, 193–219, 1977. ([link](https://doi.org/10.1016/S0006-3495(77)85544-6))\n",
    "- Barkai, N. and Leibler S., Robustness in simple biochemical networks, _Nature_, 387, 913–917, 1997. ([link](https://doi.org/10.1038/43199))\n",
    "- Parkinson, J. S., Hazelbauer, G. L., and Falke, J. J., Signaling and sensory adaptation in _Escherichia coli_ chemoreceptors: 2015 update, _Trends Microbiol._, 257–266, 2015. ([link](http://doi.org/10.1016/j.tim.2015.03.003))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9b5abd6a-8b82-4333-b0ac-4bf3c02436b6",
   "metadata": {},
   "source": [
    "<hr>\n",
    "\n",
    "## Technical appendix"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6a1514bf-7f1f-47cd-b9a9-8e6f8821565b",
   "metadata": {
    "nbsphinx-toctree": {
     "maxdepth": 1
    },
    "tags": []
   },
   "source": [
    "- [6a. Michaelis-Menten kinetics](../technical_appendices/06a_michaelis_menten.ipynb)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "88e0a58a-be3a-4420-9fc9-ca4800f39ede",
   "metadata": {
    "tags": []
   },
   "source": [
    "<hr>\n",
    "\n",
    "## Problems"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "35a67568-e9a6-4fc0-8f1a-44502f3dffe2",
   "metadata": {
    "nbsphinx-toctree": {},
    "tags": []
   },
   "source": [
    "- [6.1: Co-substrate compensation](../problems/06/problem_6.1.ipynb)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5220ae35-17b5-4af9-b79d-0b36def19263",
   "metadata": {},
   "source": [
    "## Computing environment"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "49905753-9d78-4f89-8850-61d7e056f015",
   "metadata": {
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Python implementation: CPython\n",
      "Python version       : 3.10.10\n",
      "IPython version      : 8.10.0\n",
      "\n",
      "jupyterlab: 3.5.3\n",
      "\n"
     ]
    }
   ],
   "source": [
    "%load_ext watermark\n",
    "%watermark -v -p jupyterlab"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
